library(shiny)
## Data from http://en.wikipedia.org/w/index.php?title=Letter_frequency&oldid=611734497
freqs <- c(8.167,7.636,6.516,12.525,14.634,12.117,11.745,11.920,9.383,11.503,7.486,6.025,10.110,12.217,
 1.492,0.901,1.886,2.215,1.043,0.980,0.927,2.844,1.535,1.740,1.584,2.000,1.043,0.281,
 2.782,3.260,2.732,4.139,3.882,0.776,4.501,0.963,1.486,3.895,1.242,0.565,0,0.281,
 4.253,3.669,5.076,5.860,4.992,3.044,3.736,4.706,4.702,4.225,5.933,5.858,1.575,1.043,
13.000,14.715,17.396,13.681,12.570,8.995,11.792,8.912,10.149,8.352,18.914,15.453,6.418,7.968,
 2.228,1.066,1.656,0.692,1.023,1.037,1.153,0.461,2.027,0.143,0.805,2.406,3.013,0.194,
 2.015,0.866,3.009,1.768,1.303,1.171,1.644,1.253,2.862,1.731,3.403,4.077,4.241,0.392,
 6.094,0.737,4.757,0.703,0.781,0.384,0.636,1.212,2.090,1.015,2.380,1.621,1.871,1.851,
 6.966,7.529,7.550,6.247,6.186,10.012,11.283,8.600,5.817,9.328,6.499,6.000,7.578,10.817,
 0.153,0.545,0.268,0.443,0.397,3.501,0.011,0.034,0.614,1.836,1.461,0.730,1.144,2.042,
 0.772,0.049,1.417,0.011,0.015,4.163,0.009,4.683,3.140,2.753,2.248,3.395,3.314,4.973,
 4.025,5.456,3.437,4.967,2.779,6.145,6.510,5.922,5.275,3.064,3.568,5.229,4.532,5.761,
 2.406,2.968,2.534,3.157,4.738,2.994,2.512,3.752,3.471,2.515,2.213,3.237,4.041,3.202,
 6.749,7.095,9.776,6.712,5.046,7.955,6.883,7.487,8.542,6.737,10.032,7.240,7.711,8.826,
 7.507,5.378,2.594,8.683,10.735,8.779,9.832,2.476,4.482,7.167,6.063,4.636,2.166,5.614,
 1.929,2.521,0.670,2.510,2.523,2.745,3.056,0.886,1.839,2.445,1.370,1.756,0.789,1.842,
 0.095,1.362,0.018,0.877,1.204,0,0.505,0,0.020,0,0.009,0.007,0,0.013,
 5.987,6.553,7.003,6.871,6.530,5.914,6.367,6.722,8.431,5.743,6.411,8.956,8.581,2.872,
 6.327,7.948,7.273,7.977,7.805,6.092,4.981,3.014,6.590,6.224,5.733,5.805,5.630,7.862,
 9.056,7.244,6.154,4.632,4.736,5.276,5.623,3.314,7.691,2.475,6.923,6.862,4.953,8.750,
 2.758,6.311,4.346,3.927,4.634,3.183,3.011,3.235,1.919,2.062,2.192,1.979,4.562,5.008,
 0.978,1.628,0.846,1.138,1.665,1.904,2.097,0.959,2.415,0.012,1.854,2.332,2.437,2.250,
 2.360,0.074,1.921,0.017,0.037,0,0.033,0,0.142,6.313,1.821,0.069,0,0.094,
 0.150,0.427,0.034,0.215,0.253,0,0.003,0,0.159,0.004,0.036,0.028,0.046,0.031,
 1.974,0.128,0.039,1.008,0.006,0,0.020,3.336,0.708,3.206,0.035,0.698,0.900,1.745,
 0.074,0.326,1.134,0.517,0.470,0.494,1.181,1.500,0.070,5.852,1.374,0.034,0,0.051)
langs <- c("English","French","German","Spanish","Portugese","Esperanto","Italian","Turkish","Swedish","Polish","Dutch","Danish","Icelandic","Finnish")
letters <- "abcdefghijklmnopqrstuvwxyz"

shinyServer(
  function(input, output) {
	x <- reactive({
		freq = rep(0.0, 26)
		len = nchar(input$stext)
		for (i in 1:26) {
			freq[i] = (len - nchar(gsub(substr(letters,i,i), '', input$stext))) * 100.0 / len
		}
		mse = rep(0,14)
		for (lang in 1:14) {
			m = 0.0
			for (letter in 1:26) {
				t = freq[letter] - freqs[(letter-1)*14+lang]
				m = m + t*t
			}
			mse[lang] = m/26
		}
		o = order(mse)
		res = ""
		for (i in 1:input$numLang) {
			res = paste(res, langs[o[i]], "?  mse =", as.integer(mse[o[i]]*100)/100.0, "\n")
		}
		paste(res, "\nYou entered", nchar(input$stext), "symbols:\n", input$stext)
	})
	output$inlen <- renderText({ x() })
  }
)
